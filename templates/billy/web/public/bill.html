{% extends base_template %}
{% load url from future %}
{% load humanize %}
{% load customtags %}


{% block title %}{{bill.bill_id }}{% endblock %}

{% block content %}
        <div class="fullWidth mainModule">
            <ol id="billAction">
                {% for stage, text, date in bill.progress_data %}
                <li {% if date %}class="active"{% endif %}>
                    <span class="textReplace" id="{{stage}}">{{text}}</span>
                    {% if date %}<span class="tip">{{date|date:"M j, Y"}}</span>{% endif %}
                </li>
                {% endfor %}
            </ol> 
            <h2 class="withTimeline">{{ metadata.name }} {{bill.type_string|title}} {{ bill.bill_id }}</h2>
             <a href="/admin/object_json/bills/{{bill.id}}/">json</a>
             <p class="smModule">{{ bill.title|capfirst }}</p>
             <dl class="inlineList">
                {% if bill.subjects %}
                <dt class="contentBottom oneCol">Subjects:</dt>
                <dd class="contentBottom customWidth">
                    {% for subject in bill.subjects %}
                        <a href="{% url 'bills_by_subject' abbr subject %}">{{subject}}</a>{% if not forloop.last %} | {% endif %}
                    {% endfor %}
                </dd>
                {% endif %}
                <dt class="contentBottom oneCol">Session:</dt>
                <dd class="contentBottom customWidth">{{ bill.session_details.display_name }}</dd>
                
                <dt class="contentBottom oneCol">Chamber:</dt>
                <dd class="contentBottom">{{ bill.chamber_name }}</dd>

                <dt class="clear contentBottom">Sponsors ({{ bill.sponsors|length }}):</dt>
                <dd>
                    <ul class="inlineThirds_module moduleNoBorder">

                    {% if show_all_sponsors %}
                        {% for sponsor in bill.sponsors_manager %}
                            {% if sponsor.leg_id %}
                                <li><a href="{% url 'legislator' abbr sponsor.leg_id sponsor.name|slugify %}">{{ sponsor.name }}</a>
                                {% with legislator=sponsor.legislator %}
                                    {% if legislator.active %}
                                        ({{ legislator.party }}) {{ legislator.district }}
                                    {% endif %}
                                {% endwith %}
                            {% else %}
                                {# Sponsor had no leg_id or was inactive. Might be a committee. #}
                                <li>{{ sponsor.name }}
                            {% endif %} <span class="tip sideNote">{{ sponsor.type }}</span></li>
                        {% endfor %}
                    {% else %}
                        {% for sponsor in bill.sponsors_manager.first_five %}
                            {% if sponsor.leg_id %}
                                <li><a href="{% url 'legislator' abbr sponsor.leg_id sponsor.name|slugify %}">{{ sponsor.name }}</a>
                                {% with legislator=sponsor.legislator %}
                                    {% if legislator.active %}
                                        ({{ legislator.party }}) {{ legislator.district }}
                                    {% endif %}
                                {% endwith %}
                            {% else %}
                                {# Sponsor had no leg_id or was inactive. Might be a committee. #}
                                <li>{{ sponsor.name }}
                            {% endif %} <span class="tip sideNote">{{ sponsor.type }}</span></li>
                        {% endfor %}
                        {% if bill.sponsors_manager.first_five_remainder %}
                        {% with remainder=bill.sponsors_manager.first_five_remainder %}
                        <li><a class="viewMore" href="?show_all_sponsors=True">View {{ remainder|apnumber }} other{{ remainder|pluralize}}</a></li>
                        {% endwith %}
                        {% endif %}
                    {% endif %}
                    </ul> 
                    
                </dd>    
             </dl>
             <div class="clear"></div>
        </div>
        {% if bill.versions %}
        <div class="fullWidth mainModule">
            <h3>Versions</h3><ul>
            {% for version in bill.versions %}
                <li>{{ version.name }}
                {% if "+mimetype" in version %}[{{ version|plusfield:"mimetype"}}]{% endif %}
                {{version.url|urlize}}</li>
            {% endfor %}</ul>
        </div>
        {% endif %}
        {% if bill.documents %}
        <div class="fullWidth mainModule">
            <h3>Documents</h3>
            {% for document in bill.documents %}<ul>
                <li>{{ document.name }}
                {% if "+mimetype" in document %}[{{ document|plusfield:"mimetype"}}]{% endif %}
                {{document.url|urlize}}</li>
            {% endfor %}</ul>
        </div>
        {% endif %}

        <div class="eightCol colLt">
            <h3>Recent Actions</h3>
            <table class="normalTable">
                <thead>
                    <tr id="titles">
                        <th>Date</th>
                        <th>Chamber</th>
                        <th></th>
                        <th>Labels</th>
                    </tr>
                </thead>
                <tbody>
                {% for action in bill.actions_manager %}
                    <tr class={% cycle "even" "odd" %}>
                        <td class="tip withTipSm">{{ action.date|date:"M j, Y"}}</td>
                        <td>{{ action.actor_name }}</td>
                        {% if "committee" in action %}
                            <td><a href = '/{{abbr}}/committees/{{action.committee}}' >{{ action.action_display|safe }}</a></td>
                        {% else %}
                            <td>{{ action.action_display|safe }}</td>
                        {% endif %}
                        <td>{% for label_text in action.type %}<span class="label">{{label_text}}</span>{% endfor %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="fourCol colRt">
            <h3>Votes</h3>
            {% if bill.votes_manager.has_votes %}
            <ul class="largerList voteChart">
                {% for vote in bill.votes_manager %}
                    {% include vote_preview_row_template %}
                {% endfor %}
            </ul>
            {% else %}
            No vote data is availble yet.
            {% endif %}
        </div>
{% with events=bill.events %}
{% if events.count %}
        <div class="eightCol colLt">
            <h3>Events</h3>
            <table class="normalTable">
                <thead>
                    <tr id="titles">
                        <th>Date</th>
                        <th>Where</th>
                        <th>Description</th>
                        <th>Committees</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in bill.events %}
                    <tr class = 'odd' >
                        <td class="tip withTipSm"><a href = '/{{ event.state }}/event/{{ event.id }}'
                                >{{ event.when|date:"M j, Y"}}</a></td>
                        <td>{{ event.location }}</td>
                        <td>{{ event.description }}</td>
                        <td>
                            {% for committee in event.committees %}
                            <a href = '/{{ committee.state }}/committee/{{ committee.id}}/'
                                >{{committee.display_name}}</a>
                            {% endfor %}
                        </td>
                    </tr>
            {% endfor %}
            {% endif %}
            {% endwith %}
                </tbody>
            </table>
        {% sources bill %}
        <div class="clear"></div>
        </div>
{% endblock %}
