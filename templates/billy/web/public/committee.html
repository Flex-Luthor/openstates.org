{% extends "billy/web/public/base.html" %}
{% load url from future %}
{% load customtags %}


{% block title %}
  {{committee.display_name}} -
  {{metadata.legislature_name}} -
  Open States
{% endblock %}

{% block headblock %}
<link rel="canonical" href="{{committee.get_absolute_url}}">
<script>
$(document).ready(function() {
    clickable_rows("#main-table tbody tr");
    var doc = $(document);
    doc.bind("keydown", "alt+j", function(){window.location = '{{committee.get_admin_json_url}}'});
});
</script>
{% endblock %}

{% block content %}
<ul class="breadcrumb floatedList clearfix">
    <li><a href="{{metadata.get_absolute_url}}">{{metadata.name}}</a></li>
    <li>
        » <a href="{% url 'committees' abbr %}">Committees</a>
    </li>
    <li>
        » <a href="{% url 'committees' abbr %}?chamber={{committee.chamber}}">{{committee.chamber_name}}</a>
    </li>
    <li>
        » {{committee.display_name}}
    </li>
</ul>

<h2>{{ committee.display_name }} ({{committee.chamber_name}})</h2>
<div class="fullWidth module">
    <h3 class="moduleTitle">Members</h3>
    <table id="main-table">
        <thead>
            <tr>
                <th>Name</th>
                <!--<th>Photo</th>-->
                <th>Role</th>
                <th>District</th>
                <th>Party</th>
            </tr>
        </thead>
        <tbody>
            {% for obj, legislator in committee.members_objects %}
                <tr class="{% cycle 'even' 'odd' %}">
                    {% if legislator %}
                        <td><a href="{{ legislator.get_absolute_url }}">{{ legislator.display_name }}</a></td>
                        {% else %}
                        <td>{{ obj.name }}</td>
                    {% endif %}
                    <!--<td><img src={{ obj.photo_url }}/></td>-->
                    <td>{{ obj.role|title }}</td>
                    {% if legislator %}
                          <td>{{ legislator.district }}</td>
                          <td>{{ legislator.party }}</td>
                    {% else %}
                        <td>Not available</td>
                        <td>Not available</td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% if request.user|is_dev %}
<div class="fullWidth module">
    <h3 class="moduleTitle">Developer ProTips</h3>
<pre>from sunlight import openstates

committee = openstates.committee_detail("{{committee|underscore_field:"id"}}")
print "Members of the %s" % (committee['committee'])

for member in committee['members']:
    if 'leg_id' in member and member['leg_id'] is not None:
        leg = openstates.legislator_detail(member['leg_id'])
        print " - %s" % (
            leg['full_name']
        )
    else:
        print " - %s" % (
            member['name']
        )

print "Upcoming events:"
events = openstates.events(partiticpants='{{committee|underscore_field:"id"}}')

for event in events:
    print " - %s @ %s" % (
        event['description'],
        event['location']
    )
    for bill in event['related_bills']:
        if "bill_id" in bill and bill['bill_id'] is not None:
            bobj = openstates.bill(bill['bill_id'])
            print "  + %s (%s)" % (
                bobj['title'],
                bobj['bill_id']
            )</pre>
</div>
{% endif %}
<div class="fullWidth module">
    <h3 class="moduleTitle" >Related Events</h3>
        {% if committee.events.count %}
        <ul>
            {% for event in committee.events %}
            <li><a href = "{{ event.get_absolute_url }}"
                    >{{event.description}} on {{ event.when|date:"M j, Y"}}</a><li>
            {% endfor %}
        </ul>
        {% else %}
            No events found.
        {% endif %}
    </div>
{% sources committee %}

{% endblock %}

